{% extends "base_template.html.twig" %}

{% block content1 %}
<a href="javascript:history.back()" class="btn btn-primary mt-2 ms-2">Retour</a>

{# Filtrer les œuvres sans posterPath #}
{% set oasFiltered = [] %}
{% for oa in oas %}
    {% if oa.posterPath is not empty %}
        {% set oasFiltered = oasFiltered|merge([oa]) %}
    {% endif %}
{% endfor %}

<div class="container my-4">
  <!-- Barre de navigation des onglets -->
  <div class="row mb-4">
    <div class="col text-center">
      <button id="btnGeneral" class="btn btn-primary me-2">Général</button>
      <button id="btnFilms" class="btn btn-primary me-2">Films/Séries</button>
      <button id="btnForums" class="btn btn-primary me-2">Forums</button>
      <button id="btnUsers" class="btn btn-primary">Utilisateurs</button>
    </div>
  </div>

  <!-- SECTION GÉNÉRAL : 4 films/séries, 4 forums, 4 utilisateurs -->
  <div id="sectionGeneral">
    <h3 class="my-3">Films / Séries</h3>
    <div class="row">
      {% set filmsGeneral = oasFiltered|slice(0, 4) %}
      {% if filmsGeneral is not empty %}
        {% for oa in filmsGeneral %}
          <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="card h-100 shadow-sm">
              {% if oa.type == 'Film' %}
                <a href="index.php?controleur=oa&methode=afficherFilm&idOa={{ oa.idoa }}" class="text-decoration-none">
              {% else %}
                <a href="index.php?controleur=oa&methode=afficherSerie&idOa={{ oa.idoa }}" class="text-decoration-none">
              {% endif %}
                  <img src="{{ oa.posterPath }}" class="card-img-top" alt="{{ oa.nom }}">
                  <div class="card-body d-flex flex-column">
                    <h6 class="card-title text-center text-dark">{{ oa.nom }}</h6>
                  </div>
                </a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-center">Aucun film ou série trouvé.</p>
      {% endif %}
    </div>
    
    <h3 class="my-3">Forums</h3>
    <div class="row">
      {% set forumsGeneral = forums|slice(0, 4) %}
      {% if forumsGeneral is not empty %}
        {% for forum in forumsGeneral %}
          <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="card h-100 shadow-sm">
              <a href="index.php?controleur=message&methode=listerMessage&idForum={{ forum.getIdForum }}" class="text-decoration-none">
                <div class="card-body d-flex flex-column">
                  <h6 class="card-title text-center text-dark">{{ forum.getNom }}</h6>
                  <p class="card-text text-center">{{ forum.getDescription }}</p>
                </div>
              </a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-center">Aucun forum trouvé.</p>
      {% endif %}
    </div>
    
    <h3 class="my-3">Utilisateurs</h3>
    <div class="row">
      {% set usersGeneral = users|slice(0, 4) %}
      {% if usersGeneral is not empty %}
        {% for user in usersGeneral %}
          <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="card h-100 shadow-sm">
              <a href="index.php?controleur=utilisateur&methode=afficherAutreUtilisateur&pseudo={{ user.getPseudo }}" class="text-decoration-none">
                <img src="{{ 'img/profils/' ~ user.getPhotoProfil }}" class="card-img-top" alt="{{ user.getPseudo }}">
                <div class="card-body d-flex flex-column">
                  <h6 class="card-title text-center text-dark">{{ user.getPseudo }}</h6>
                </div>
              </a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-center">Aucun utilisateur trouvé.</p>
      {% endif %}
    </div>
  </div>

  <!-- SECTION FILMS/SÉRIES -->
  <div id="sectionFilms" style="display: none;">
    <h2 class="text-center my-4">Résultats Films/Séries pour : "{{ requete }}"</h2>
    <div class="row">
      {% if oasFiltered is not empty %}
        {% for oa in oasFiltered %}
          <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="card h-100 shadow-sm">
              {% if oa.type == 'Film' %}
                <a href="index.php?controleur=oa&methode=afficherFilm&idOa={{ oa.idoa }}" class="text-decoration-none">
              {% else %}
                <a href="index.php?controleur=oa&methode=afficherSerie&idOa={{ oa.idoa }}" class="text-decoration-none">
              {% endif %}
                  <img src="{{ oa.posterPath }}" class="card-img-top" alt="{{ oa.nom }}">
                  <div class="card-body d-flex flex-column">
                    <h6 class="card-title text-center text-dark">{{ oa.nom }}</h6>
                  </div>
                </a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-center">Aucun film ou série trouvé.</p>
      {% endif %}
    </div>
  </div>

  <!-- SECTION FORUMS -->
  <div id="sectionForums" style="display: none;">
    <h2 class="text-center my-4">Résultats Forums pour : "{{ requete }}"</h2>
    <div class="row">
      {% if forums is not empty %}
        {% for forum in forums %}
          <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="card h-100 shadow-sm">
              <a href="index.php?controleur=message&methode=listerMessage&idForum={{ forum.getIdForum }}" class="text-decoration-none">
                <div class="card-body d-flex flex-column">
                  <h6 class="card-title text-center text-dark">{{ forum.getNom }}</h6>
                  <p class="card-text text-center">{{ forum.getDescription }}</p>
                </div>
              </a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-center">Aucun forum trouvé.</p>
      {% endif %}
    </div>
  </div>

  <!-- SECTION UTILISATEURS -->
  <div id="sectionUsersSearch" style="display: none;">
    <h2 class="text-center my-4">Résultats Utilisateurs pour : "{{ requete }}"</h2>
    <div class="row">
      {% if users is not empty %}
        {% for user in users %}
          <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="card h-100 shadow-sm">
              <a href="index.php?controleur=utilisateur&methode=afficherAutreUtilisateur&pseudo={{ user.getPseudo }}" class="text-decoration-none">
                <img src="{{ 'img/profils/' ~ user.getPhotoProfil }}" class="card-img-top" alt="{{ user.getPseudo }}">
                <div class="card-body d-flex flex-column">
                  <h6 class="card-title text-center text-dark">{{ user.getPseudo }}</h6>
                </div>
              </a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-center">Aucun utilisateur trouvé.</p>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}

{% block scripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const btnGeneral = document.getElementById('btnGeneral');
  const btnFilms = document.getElementById('btnFilms');
  const btnForums = document.getElementById('btnForums');
  const btnUsers = document.getElementById('btnUsers');

  const sectionGeneral = document.getElementById('sectionGeneral');
  const sectionFilms = document.getElementById('sectionFilms');
  const sectionForums = document.getElementById('sectionForums');
  const sectionUsersSearch = document.getElementById('sectionUsersSearch');

  // Affichage par défaut : onglet Général
  sectionGeneral.style.display = 'block';
  sectionFilms.style.display = 'none';
  sectionForums.style.display = 'none';
  sectionUsersSearch.style.display = 'none';

  btnGeneral.addEventListener('click', function () {
    sectionGeneral.style.display = 'block';
    sectionFilms.style.display = 'none';
    sectionForums.style.display = 'none';
    sectionUsersSearch.style.display = 'none';
  });
  btnFilms.addEventListener('click', function () {
    sectionGeneral.style.display = 'none';
    sectionFilms.style.display = 'block';
    sectionForums.style.display = 'none';
    sectionUsersSearch.style.display = 'none';
  });
  btnForums.addEventListener('click', function () {
    sectionGeneral.style.display = 'none';
    sectionFilms.style.display = 'none';
    sectionForums.style.display = 'block';
    sectionUsersSearch.style.display = 'none';
  });
  btnUsers.addEventListener('click', function () {
    sectionGeneral.style.display = 'none';
    sectionFilms.style.display = 'none';
    sectionForums.style.display = 'none';
    sectionUsersSearch.style.display = 'block';
  });
});
</script>
{% endblock %}
